<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard ‚Äî Resonance</title>
  <link rel="icon" type="image/png" href="papermint_logo.png" />
  <link rel="stylesheet" href="styles.css" />
  <script src="theme.js"></script>
</head>
<body>
  <div class="dashboard">

    <!-- ===== TOP BAR ===== -->
    <header class="dashboard-topbar">
      <div class="topbar-left">
        <button type="button" class="btn btn-ghost sidebar-toggle" id="sidebar-toggle" onclick="toggleSidebar()" title="Toggle menu">‚ò∞</button>
        <a href="index.html" class="topbar-logo" style="text-decoration:none"><img src="papermint_logo.png" alt="" class="logo-icon" /> resonance</a>
      </div>
      <div class="topbar-right">
        <div class="avatar-dropdown">
          <button type="button" class="avatar avatar-btn" id="avatar" onclick="toggleAvatarMenu()" title="Account">J</button>
          <div class="avatar-menu" id="avatar-menu">
            <a href="settings.html" class="avatar-menu-item">‚öô Preferences</a>
            <button type="button" class="avatar-menu-item" onclick="handleLogout()">Log out</button>
          </div>
        </div>
      </div>
    </header>

    <!-- ===== SIDEBAR ‚Äî previous topics ===== -->
    <aside class="dashboard-sidebar" id="dashboard-sidebar">
      <div class="sidebar-item" id="new-search-btn" onclick="showHome()">
        <span class="icon">+</span> New search
      </div>
      <div class="sidebar-label">Previous topics</div>
      <div id="sidebar-topics">
        <!-- filled by JS -->
      </div>
      <button type="button" class="sidebar-item sidebar-clear-btn" id="clear-topics-btn" onclick="clearAllTopics()" title="Remove all previous topics">
        <span class="icon">üóë</span> Clear all topics
      </button>
      <div class="sidebar-spacer"></div>
      <div class="sidebar-label">Explore</div>
      <div class="sidebar-item" onclick="window.location='ideas.html'">
        <span class="icon">‚ú¶</span> Top Ideas
      </div>
      <div class="sidebar-label">Settings</div>
      <div class="sidebar-item" onclick="window.location='settings.html'">
        <span class="icon">‚öô</span> Preferences
      </div>
    </aside>

    <!-- ===== MAIN CONTENT ===== -->
    <main class="dashboard-main" id="main-content">

      <!-- Greeting -->
      <div class="greeting" id="greeting">
        <h1>Good morning</h1>
        <p>What research direction would you like to explore?</p>
      </div>

      <!-- Search (home state) -->
      <div class="search-area" id="search-area">
        <div class="search-prompt">
          <input
            type="text"
            id="topic-input"
            placeholder="e.g. mechanistic interpretability, protein folding ‚Ä¶"
            autocomplete="off"
          />
          <button class="search-btn" onclick="submitTopic()">‚Üí</button>
        </div>
        <div class="search-sources" id="search-sources">
          <span class="search-sources-label">Sources:</span>
          <label class="source-chip"><input type="checkbox" id="ds-source-arxiv" /> arXiv</label>
          <label class="source-chip"><input type="checkbox" id="ds-source-biorxiv" /> bioRxiv</label>
          <label class="source-chip"><input type="checkbox" id="ds-source-openalex" /> OpenAlex</label>
          <label class="source-chip"><input type="checkbox" id="ds-source-semantic_scholar" /> Semantic Scholar</label>
          <label class="source-chip"><input type="checkbox" id="ds-source-internet" /> Internet</label>
        </div>
        <div class="search-options-row" id="search-options-row">
          <div class="search-option-group">
            <span class="search-options-label">Model:</span>
            <label class="source-chip model-chip" title="Fast (Claude Haiku)">
              <input type="radio" name="ds-model" id="ds-model-fast" value="fast" checked /> Fast
            </label>
            <label class="source-chip model-chip" title="Deep (Claude Sonnet)">
              <input type="radio" name="ds-model" id="ds-model-deep" value="deep" /> Deep
            </label>
          </div>
          <div class="search-option-group">
            <span class="search-options-label">Since:</span>
            <button type="button" class="quick-date-btn" data-offset="1m" onclick="setQuickDate(this,'1m')">1 mo</button>
            <button type="button" class="quick-date-btn" data-offset="3m" onclick="setQuickDate(this,'3m')">3 mo</button>
            <button type="button" class="quick-date-btn" data-offset="6m" onclick="setQuickDate(this,'6m')">6 mo</button>
            <button type="button" class="quick-date-btn" data-offset="1y" onclick="setQuickDate(this,'1y')">1 yr</button>
            <button type="button" class="quick-date-btn" data-offset="2y" onclick="setQuickDate(this,'2y')">2 yr</button>
            <button type="button" class="quick-date-btn active" data-offset="" onclick="setQuickDate(this,'')">Any</button>
            <input type="date" id="ds-earliest-date" class="ds-date-input" title="Earliest publication date" />
          </div>
        </div>
        <span class="search-hint">Press Enter to explore a topic</span>
      </div>

      <!-- Topic results (hidden until a topic is selected) -->
      <div class="topic-view" id="topic-view">
        <div class="topic-header">
          <div>
            <h2 id="topic-title">Mechanistic Interpretability</h2>
            <span class="topic-meta" id="topic-meta">6 promising papers ¬∑ last run 2 hours ago</span>
          </div>
          <div class="topic-header-actions">
            <button class="btn btn-outline" id="cancel-search-btn" onclick="cancelSearch()" style="display:none;">
              <span>‚èπ</span> Cancel search
            </button>
            <button class="btn btn-outline" id="rerun-btn">
              <span>‚Üª</span> Rerun search
            </button>
          </div>
        </div>

        <table class="papers-table">
          <thead>
            <tr>
              <th>Paper</th>
              <th>Authors</th>
              <th>Published</th>
              <th>Verdict</th>
              <th>Confidence</th>
              <th>Link</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="papers-tbody">
            <!-- filled by JS -->
          </tbody>
        </table>
      </div>
    </main>
  </div>

  <!-- ===== SIDE PANEL (paper detail) ===== -->
  <div class="side-panel-overlay" id="panel-overlay"></div>
  <div class="side-panel" id="side-panel">
    <div class="panel-header">
      <h3>Paper details</h3>
      <button class="panel-close" onclick="closePanel()">‚úï</button>
    </div>
    <div class="panel-body" id="panel-body">
      <!-- filled by JS -->
    </div>
  </div>

  <!-- ===== FLOATING CHAT PANEL ===== -->
  <div id="chat-panel" class="chat-float">
    <div class="chat-float-header">
      <div class="chat-float-title">
        <span class="chat-float-icon">üí¨</span>
        <h4 id="chat-title">Chat</h4>
      </div>
      <div class="chat-float-actions">
        <button class="chat-float-btn" onclick="resetChat()" title="New conversation">‚Üª</button>
        <button class="chat-float-btn" onclick="closeChatPanel()">‚úï</button>
      </div>
    </div>
    <div class="chat-float-body" id="chat-body">
      <!-- messages rendered here -->
    </div>
    <div class="chat-float-suggestions" id="chat-suggestions">
      <!-- suggestion chips rendered here -->
    </div>
    <div class="chat-float-input">
      <input id="chat-input-field" type="text" placeholder="Ask about this paper‚Ä¶"
        onkeydown="if(event.key==='Enter')sendChat()" autocomplete="off" />
      <button onclick="sendChat()" id="chat-send-btn">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M8 14V2M8 2L3 7M8 2L13 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Supabase SDK (CDN) + our shared client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="supabase.js"></script>
  <script src="app.js"></script>
</body>
</html>

