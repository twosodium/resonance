<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard â€” Papermint</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="dashboard">

    <!-- ===== TOP BAR ===== -->
    <header class="dashboard-topbar">
      <div class="topbar-left">
        <span class="topbar-logo">â—† papermint</span>
      </div>
      <div class="topbar-right">
        <button class="btn btn-ghost" onclick="handleLogout()">Log out</button>
        <div class="avatar" id="avatar">J</div>
      </div>
    </header>

    <!-- ===== SIDEBAR â€” previous topics ===== -->
    <aside class="dashboard-sidebar">
      <div class="sidebar-item" id="new-search-btn" onclick="showHome()">
        <span class="icon">+</span> New search
      </div>
      <div class="sidebar-label">Previous topics</div>
      <div id="sidebar-topics">
        <!-- filled by JS -->
      </div>
      <div class="sidebar-spacer"></div>
      <div class="sidebar-label">Explore</div>
      <div class="sidebar-item" onclick="window.location='ideas.html'">
        <span class="icon">âœ¦</span> Top Ideas
      </div>
      <div class="sidebar-label">Settings</div>
      <div class="sidebar-item" onclick="window.location='settings.html'">
        <span class="icon">âš™</span> Preferences
      </div>
    </aside>

    <!-- ===== MAIN CONTENT ===== -->
    <main class="dashboard-main" id="main-content">

      <!-- Greeting -->
      <div class="greeting" id="greeting">
        <h1>Good morning</h1>
        <p>What research direction would you like to explore?</p>
      </div>

      <!-- Search (home state) -->
      <div class="search-area" id="search-area">
        <div class="search-prompt">
          <input
            type="text"
            id="topic-input"
            placeholder="e.g. mechanistic interpretability, protein folding â€¦"
            autocomplete="off"
          />
          <button class="search-btn" onclick="submitTopic()">â†’</button>
        </div>
        <span class="search-hint">Press Enter to explore a topic</span>
      </div>

      <!-- Topic results (hidden until a topic is selected) -->
      <div class="topic-view" id="topic-view">
        <div class="topic-header">
          <div>
            <h2 id="topic-title">Mechanistic Interpretability</h2>
            <span class="topic-meta" id="topic-meta">6 promising papers Â· last run 2 hours ago</span>
          </div>
          <button class="btn btn-outline" id="rerun-btn">
            <span>â†»</span> Rerun search
          </button>
        </div>

        <table class="papers-table">
          <thead>
            <tr>
              <th>Paper</th>
              <th>Authors</th>
              <th>Published</th>
              <th>Verdict</th>
              <th>Confidence</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="papers-tbody">
            <!-- filled by JS -->
          </tbody>
        </table>
      </div>
    </main>
  </div>

  <!-- ===== SIDE PANEL (paper detail) ===== -->
  <div class="side-panel-overlay" id="panel-overlay"></div>
  <div class="side-panel" id="side-panel">
    <div class="panel-header">
      <h3>Paper details</h3>
      <button class="panel-close" onclick="closePanel()">âœ•</button>
    </div>
    <div class="panel-body" id="panel-body">
      <!-- filled by JS -->
    </div>
  </div>

  <!-- ===== FLOATING CHAT PANEL ===== -->
  <div id="chat-panel" class="chat-float">
    <div class="chat-float-header">
      <div class="chat-float-title">
        <span class="chat-float-icon">ðŸ’¬</span>
        <h4 id="chat-title">Chat</h4>
      </div>
      <div class="chat-float-actions">
        <button class="chat-float-btn" onclick="resetChat()" title="New conversation">â†»</button>
        <button class="chat-float-btn" onclick="closeChatPanel()">âœ•</button>
      </div>
    </div>
    <div class="chat-float-body" id="chat-body">
      <!-- messages rendered here -->
    </div>
    <div class="chat-float-suggestions" id="chat-suggestions">
      <!-- suggestion chips rendered here -->
    </div>
    <div class="chat-float-input">
      <input id="chat-input-field" type="text" placeholder="Ask about this paperâ€¦"
        onkeydown="if(event.key==='Enter')sendChat()" autocomplete="off" />
      <button onclick="sendChat()" id="chat-send-btn">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M8 14V2M8 2L3 7M8 2L13 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Supabase SDK (CDN) + our shared client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="supabase.js"></script>
  <script src="app.js"></script>
</body>
</html>

